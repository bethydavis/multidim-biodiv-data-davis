---
title: "Abundance Data"
teaching: 10
exercises: 2
---

:::::::::::::::::::::::::::::::::::::: questions 

- How to import abundance data?
- How to clean abundance data?
- How to summarize abundance data?
- How to vizualize abundance data?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

After following this episode, participants should be able to...

1. Import abundance data in a CSV format into R environment
2. Clean taxonomic names using the `taxize` package
3. Aggregate abundances
4. Calculate Hill numbers 
5. Interpret Hill numbers
6. Vizualize species abundance distributions
7. Interpret species abundance distribution plots
8. Connect species abundance patterns to Hill numbers





::::::::::::::::::::::::::::::::::::::::::::::::

## Introduction

If you've done work in the spheres of population or community ecology, chances are you have already worked some with organismal abundance data - that is, _counts of the population sizes of the different species within a system_. Here, we'll work through some approaches for importing, wrangling, and summarizing abundance data. 


## Setup

For this lesson, we'll need a few packages commonly used in ecology.

```{r package imports}

library(dplyr)
library(ggplot2)
library(hillR)

```

## Data import 

Abundance data are often stored in the `.csv` format. Here, we'll load data from the `data` directory of this lesson.

::: instructor
We'll want to update the data path.

```{r data import}

abundances <- read.csv(here::here("episodes", "data", "abundance_data.csv")) 


```


```{r abund cleaning}
## Abundances as imported has a few duplicate species.
## The following might make a good lesson on data cleaning, doing this without explanation for now

dups <- abundances %>%
    group_by(island, site, GenSp) %>%
    summarize(n = dplyr::n()) %>%
    ungroup() %>%
    filter(n > 1)

dups

abundances <- abundances %>%
    group_by(island, site, GenSp) %>%
    summarize(abundance = sum(abundance)) %>%
    ungroup()

```



<!-- ::: challenge -->

<!-- ### Import and clean abundance data -->

<!-- Rearrange these lines of code to import and clean an abundance dataset -->

<!-- ```{r abund-import, eval = FALSE} -->
<!-- names(cleanTax) <- c('sp', 'clean_name') -->

<!-- cleanTax <- gnr_resolve(abund$sp,  -->
<!--                         best_match_only = TRUE) -->

<!-- cleanTax <- cleanTax[, c('user_supplied_name', 'matched_name')] -->


<!-- cleanTax$matched_name <- gsub(' \\(.*', '', cleanTax$matched_name) -->


<!-- library(taxize) -->

<!-- abund <- read.csv('data/abund.csv') -->

<!-- abund <- aggregate(list(abund = abund$n), list(sp = abund$clean_name), sum) -->

<!-- abund <- merge(abund, cleanTax) -->
<!-- ``` -->

<!-- :::::: solution -->

<!-- ```{r abund-import-sol, eval = FALSE} -->
<!-- library(taxize) -->

<!-- abund <- read.csv('data/abund.csv') -->

<!-- cleanTax <- gnr_resolve(abund$sp,  -->
<!--                         best_match_only = TRUE) -->

<!-- cleanTax$matched_name <- gsub(' \\(.*', '', cleanTax$matched_name) -->
<!-- cleanTax <- cleanTax[, c('user_supplied_name', 'matched_name')] -->
<!-- names(cleanTax) <- c('sp', 'clean_name') -->

<!-- abund <- merge(abund, cleanTax) -->

<!-- abund <- aggregate(list(abund = abund$n), list(sp = abund$clean_name), sum) -->
<!-- ``` -->

<!-- ::::::::::::::: -->

:::::::::::::
