---
title: 'phylo_hill'
teaching: 10
exercises: 2
---

:::::::::::::::::::::::::::::::::::::: questions 

- How do you calculate phylogenetic hill numbers in R?
- How do different phylogenetic structures and community structures translate into different values for phylogenetic hill numbers?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

- Use `hillR` to calculate phylogenetic hill numbers in R
- Interpret how hill numbers change with different phylogenetic structures and community composition.

::::::::::::::::::::::::::::::::::::::::::::::::

::: instructor

Assumed to follow:

- introduction to Newick phylogenies, `ape`, hill numbers using `hillR`.

Assumed to precede (?):

- calculations on "real" data

:::

```{r}
library(ape)

uneven_tree <- read.tree(text = '((A:0.5,B:0.5):2.5,C:3);')

plot(uneven_tree)

even_tree <- read.tree(text = '((A:2.5,B:2.5,C:2.5):0.5);')

plot(even_tree)


uneven_community1 <- data.frame(
    A = 50,
    B = 50,
    C = 300
)

uneven_community2 <- data.frame(
    A = 225,
    B = 225,
    C = 50
)

even_community <- data.frame(
    A = 125,
    B = 125,
    C = 125
)



library(hillR)

## Even community

### Even tree

even_even <- data.frame(
    hill_nb = NA,
    q = 0:3,
    scenario = "even community, even tree"
)


for(i in 1:nrow(even_even)) {
    
    even_even$hill_nb[i] <- hill_phylo(even_community, even_tree, q = even_even$q[i])

}


even_even


### Uneven tree


even_uneven <- data.frame(
    hill_nb = NA,
    q = 0:3,
    scenario = "even community, uneven tree"
)


for(i in 1:nrow(even_uneven)) {
    even_uneven$hill_nb[i] <- hill_phylo(even_community, uneven_tree, q = even_uneven$q[i])
}


even_uneven
```

::: callout

If community abundances are all equal, a more uneven tree (in terms of branch lengths) will give _lower_ overall hill numbers. 

:::

::: challenge

Experiment with changing branch lengths and see how this affects hill numbers in a perfectly even community.

You can use code based on this solution:

:::: solution

```{r}
# Update these branch lengths as much as you like
new_tree <- read.tree(text = '((A:0.5,B:0.5):0.5,C:3);') 

even_new <- data.frame(
    hill_nb = NA,
    q = 0:3,
    scenario = "even community, new tree"
)


for(i in 1:nrow(even_new)) {
    even_new$hill_nb[i] <- hill_phylo(even_community, new_tree, q = even_new$q[i])
}


plot(new_tree)
even_new

```

:::

:::

::::::::::::::::::::::::::::::::::::: keypoints 

- `hillR` calculates phylogenetic hill numbers given a phylogeny and a site by species matrix.
- Both the phylogenetic structure (branch lengths) and community structure (relative abundance of different species) contribute to phylogenetic hill numbers.

::::::::::::::::::::::::::::::::::::::::::::::::

